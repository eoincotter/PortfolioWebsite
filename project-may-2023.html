<html>
	<head>
		<link rel="stylesheet" href="styling.css" type = "text/css">
		<link rel="shortcut icon" type="image/png" href="ECIcon.png">
		<title> Eoin Cotter | May 2023 Project </title>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Montserrat&display=swap" rel="stylesheet">
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	</head>
	<body>
		<header>
			<a href = "index.html" class = "no-underline"> <p> HOME </p> </a>
			<a href = "projects.html" class = "no-underline"> <p> PROJECTS </p> </a> 
		</header>
		<section>
			<h1> May 2023 | Create a Quantified Self Dashboard </h1>
			<p> 
				The aim of this project was to create a web app which allowed me to input data on my habits, health, and exercise, store the data in a remote database, 
				and present the data over time through two dashboards. I used R shiny to create the data entry form and dashboard interface, Azure SQL Database for data storage, and ggplot2 for data visualisation.
			<h3> Contents </h3>
			<ul>
				<li><a href=#section-one> Define data requirements and set up a remote database </a></li>
				<li><a href=#section-two> Create a wireframe </a></li>
				<li><a href=#section-three> Create the UI </a>
				   <ul>
					   <li><a href=#section-three-a> Web app navigation </a></li>
					   <li><a href=#section-three-b> Data Input page </a></li>
					   <li><a href=#section-three-c> Habits page </a></li>
					   <li><a href=#section-three-d> Health & Exercise page </a></li> 
				   </ul>
				</li>
				<li><a href=#section-four> Connect to the database and update it with user input</a></li>
				<li><a href=#section-five> Add plots </a>
					<ul>
						<li><a href=#section-five-a> Habits page </a>
						<li><a href=#section-five-b> Health & Exercise page </a>
					</ul>
				</li>
				<li><a href=#section-six> Deploy to shinyapps.io </a></li>
				
			</ul>
			</p>
			<h3 id="section-one"> Define data requirements and set up a remote database </h3>
			<p> I decided I wanted to track the following measures related to my health, exercise, and good habits.</p>
			<table>
			  <thead>
				<tr>
				  <th>Health & Exercise</th>
				  <th>Daily Habits</th>
				  <th>Weekly Habits</th>
				</tr>
			  </thead>
			  <tbody>
				<tr>
				  <td>Body weight (kg)</td>
				  <td>Yoga (30 mins)</td>
				  <td>Go for a run</td>
				</tr>
				<tr>
				  <td>Calorie intake</td>
				  <td>Resistance training (60 mins)</td>
				  <td>Watch a movie</td>
				</tr>
				<tr>
				  <td>Protein intake (% of calorie intake)</td>
				  <td>Cold shower</td>
				  <td><a href="https://gettingthingsdone.com/" target="_blank">GTD</a> weekly review</td>
				</tr>
				<tr>
				  <td>Sleep hours</td>
				  <td>Meditation (20 mins)</td>
				  <td></td>
				</tr>
				<tr>
				  <td>Weight per resistance exercise</td>
				  <td>Meditation learning (10 mins)</td>
				  <td></td>
				</tr>
				<tr>
				  <td>Run distance (km)</td>
				  <td>Book reading (10 mins)</td>
				  <td></td>
				</tr>
				<tr>
				  <td>Run time</td>
				  <td>Analytics project (60 mins)</td>
				  <td></td>
				</tr>
				<tr>
				  <td></td>
				  <td>Newsletter reading</td>
				  <td></td>
				</tr>
				<tr>
				  <td></td>
				  <td>Journal</td>
				  <td></td>
				</tr>
			  </tbody>
			</table>
			<p>
			Before beginning this project I had been manually collecting some of these data points for a couple of months in an Excel file. 
			But since I wanted my app to allow data input and retrieval on the web I needed to start storing this data in a remote database. 
			I chose to use Azure SQL Database. I didnâ€™t thoroughly research the options for remote db storage but I chose Azure because they offer a year for free 
			and I wanted to become more familiar with the platform. <a href="https://learn.microsoft.com/en-us/azure/azure-sql/database/single-database-create-quickstart?view=azuresql&tabs=azure-portal" target="_blank">
			Once the db was created</a> I added my data by connecting to the db in SQL Server Management Studio 
			and importing the Excel file as a new table named <code>habits_and_health_data</code>. Below is a summary of <code>habits_and_health_data</code>:
			</p>
			<table>
			  <thead>
				<tr>
				  <th>Column Name</th>
				  <th>Data Type</th>
				</tr>
			  </thead>
			  <tbody>
				<tr>
				  <td>date</td>
				  <td>datetime</td>
				</tr>
				<tr>
				  <td>yoga_mins</td>
				  <td>int</td>
				</tr>
				<tr>
				  <td>resistance_training_mins</td>
				  <td>int</td>
				</tr>
				<tr>
				  <td>cold_shower</td>
				  <td>nvarchar</td>
				</tr>
				<tr>
				  <td>meditation_mins</td>
				  <td>int</td>
				</tr>
				<tr>
				  <td>meditation_study_mins</td>
				  <td>int</td>
				</tr>
				<tr>
				  <td>book_reading_mins</td>
				  <td>int</td>
				</tr>
				<tr>
				  <td>analytics_project_mins</td>
				  <td>int</td>
				</tr>
				<tr>
				  <td>read_newsletters</td>
				  <td>nvarchar</td>
				</tr>
				<tr>
				  <td>journal</td>
				  <td>nvarchar</td>
				</tr>
				<tr>
				  <td>sleep_hrs</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>protein_intake</td>
				  <td>int</td>
				</tr>
				<tr>
				  <td>calorie_intake</td>
				  <td>int</td>
				</tr>
				<tr>
				  <td>weight</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>run_distance</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>run_time</td>
				  <td>time</td>
				</tr>
				<tr>
				  <td>deadlift</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>rdl</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>forearm_leg_raises</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>bench_press</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>seated_barbell_shoulder_press</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>seated_dumbbell_shoulder_press</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>ez_bar_bicep_curl</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>fortyfive_degree_leg_press</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>horizontal_leg_press</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>lying_hamstring_curl</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>pulley_crunch</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>seated_pulley_row</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>lat_pulldown</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>machine_shoulder_press</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>rope_tricep_pushdown</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>bar_tricep_pushdown</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>oblique_twist</td>
				  <td>float</td>
				</tr>
				<tr>
				  <td>movie</td>
				  <td>nvarchar</td>
				</tr>
				<tr>
				  <td>GTD_weekly_review</td>
				  <td>nvarchar</td>
				</tr>
			  </tbody>
			</table>
			<h3 id="section-two"> Create a wireframe </h3>
			<p>
			Before writing any code I hand-sketched a simple wireframe to get my vision for the UI out of my head and onto paper. This was useful for planning and guiding
			the rest of the project.
			</p>
			<h3 id="section-three"> Create the UI for the web app </h3>
			<p>
			All shiny apps have three components: a UI object, server function, and a call to the shinyApp function. So the first step was to create the basic UI, 
			starting with the overall layout for the web app to allow navigation between the three pages.
			</p>
			<h3 id="section-three-a"><i> Navigating the web app </i></h3>
			<pre>
			<code>
# Define the UI
ui <- navbarPage(

  # Application title
  title = "Habits & Health Insights",
  
  # set the theme
  theme = shinytheme("cosmo"),
  
  # add three tabs
  tabPanel("Data Input"),
  tabPanel("Habits"),
  tabPanel("Health & Exercise")
  )
			</code>
			</pre>
			<p>
			<code>navbarPage()</code> creates a multi-tab web app with a navigation bar to move between the various tabs.
			Here I added a title for the app, set the theme using one of the built-in shiny themes,
			and used the <code>tabPanel()</code> function to add three tabs: Data Input, Habits, and Health & Exercise. The next step was to define the UI within
			<code>tabPanel()</code> for each of the three pages.
			</p>
			<h3 id="section-three-b"><i> Data Input page UI</i></h3>
			<pre>
			<code>
# define the UI for the Data Input page
  tabPanel("Data Input",
           fluidRow(
             column(
               width = 12,
               align = "center",
               dateInput(
                 "date_input",
                 "Choose a date",
                 format = "d M yyyy",
                 weekstart = 1,
                 value = as.Date(Sys.Date()),
                 max = as.Date(Sys.Date())
               ),
               h3("Health"),
               numericInput("sleep_hrs", "Sleep hours", value = NULL),
               numericInput("protein_intake", "Protein intake %", value = NULL, step = 1, min = 0, max = 100),
               numericInput("calorie_intake", "Calorie intake (kcal)", value = NULL),
               numericInput("weight", "Weight (kg)", value = NULL),
               h3("Exercise"),
               numericInput("yoga_mins", "Yoga minutes", value = NULL, min = 0, max = 1440),
               numericInput("resistance_training_mins", "Resistance training minutes", value = NULL, min = 0, max = 1440),
               numericInput("run_distance", "Run distance", value = NULL),
               textInput("run_time", "Run time (HH:MM:SS)", placeholder = "HH:MM:SS"),
               h3("Mental Well-Being"),
               selectInput("journal", "Journal?", choices = c("", "Yes", "No")),
               selectInput("cold_shower", "Cold shower?", choices = c("","Yes", "No")),
               numericInput("meditation_mins", "Meditation minutes", value = NULL, min = 0, max = 1440),
               h3("Learning"),
               numericInput("meditation_study_mins", "Meditation study minutes", value = NULL, min = 0, max = 1440),
               numericInput("book_reading_mins", "Book reading minutes", value = NULL, min = 0, max = 1440),
               numericInput("analytics_project_mins", "Analytics project minutes", value = NULL),
               selectInput("read_newsletters", "Read newsletters?", choices = c("", "Yes", "No")),
               h3("Other"),
               selectInput("watch_movie", "Watch movie?", choices = c("", "Yes", "No")),
               selectInput("GTD_weekly_review", "GTD weekly review?", choices = c("", "Yes", "No")),
               h3("Leg Exercises"),
               numericInput("deadlift", "Deadlift", value = NULL, min = 0),
               numericInput("rdl", "RDL", value = NULL, min = 0),
               numericInput("fortyfive_degree_leg_press", "45 degree leg press", value = NULL, min = 0),
               numericInput("horizontal_leg_press", "Horizontal leg press", value = NULL, min = 0),
               numericInput("lying_hamstring_curl", "Lying hamstring curl", value = NULL, min = 0),
               h3("Push Exercises"),
               numericInput("bench_press", "Bench press", value = NULL, min = 0),
               numericInput("seated_barbell_shoulder_press", "Seated barbell shoulder press", value = NULL, min = 0),
               numericInput("seated_dumbbell_shoulder_press", "Seated dumbbell shoulder press", value = NULL, min = 0),
               numericInput("machine_shoulder_press", "Machine shoulder press", value = NULL, min = 0),
               numericInput("rope_tricep_pushdown", "Rope tricep pushdown", value = NULL, min = 0),
               numericInput("bar_tricep_pushdown", "Bar tricep pushdown", value = NULL, min = 0),
               h3("Pull Exercises"),
               numericInput("ez_bar_bicep_curl", "EZ-Bar bicep curl", value = NULL, min = 0),
               numericInput("seated_pulley_row", "Seated pulley row", value = NULL, min = 0),
               numericInput("lat_pulldown", "Lat pulldown", value = NULL, min = 0),
               h3("Ab Exercises"),
               numericInput("pulley_crunch", "Pulley crunch", value = NULL, min = 0),
               numericInput("oblique_twist", "Oblique twist", value = NULL, min = 0),
               numericInput("forearm_leg_raises", "Forearm leg raises", value = NULL, min = 0),
               h3("Submit"),
               textInput("password", "Enter password for data submission"),
               actionButton(
                 "submit_data",
                 "Submit data"
               ),
               textOutput("submission_confirmation") 
             )
           )
  ),			
			</code>
			</pre>
			<p>
			This created a single-column input form centered on the page with a user input field related to each column in the
            <code>habits_and_health_data</code> db table. There is also a submission section with a password input field, a submission button,
			and text output to be displayed once the submission button is clicked. The logic for the processing of these elements will later be defined
			in the server function. For now the focus is on the basic UI.
			</p>
			<h3 id="section-three-c"><i> Habits page UI</i></h3>
			<pre>
			<code>
# define the UI for the "Habits" page
  tabPanel("Habits",
           fluidRow(
             column(
               width = 12,
               align = "center",
               selectInput(
                 "habit_selection",
                 "Select a habit",
                 choices = c(
                   "Resistance training",
                   "Yoga",
                   "Resistance training or yoga",
                   "Run",
                   "Meditation",
                   "Journalling",
                   "Cold shower",
                   "Book reading",
                   "Meditation study",
                   "Newsletter reading",
                   "Analytics project"
                 )
               ),
               selectInput(
                 "year_selection",
                 "Select a year",
                 choices = c(
                   "2023"
                 )
               ),
               dateRangeInput(
                 "date_range_selection",
                 "Select a date range",
                 start = "2023-01-01",
                 end = Sys.Date(),
                 format = "d M yyyy",
                 weekstart = 1
               )
             )
           ),
           fluidRow(
             column(
               width = 12,
               plotOutput("habit_plot")
             )
           )
  ),
			</code>
			</pre>
			<p>
			This again created a centered single-column page which provides user input fields to select a habit, year and date range. Below this a plot with the ID <code>
			habit_plot</code> is displayed. This plot, along with the plots on the Health & Exercise page, will be designed later in the server function.
			</p>
			<h3 id="section-three-d"><i> Health & Exercise page UI</i></h3>
			<pre>
			<code>
			# define the UI for the "Health & Exercise" page ####
  tabPanel("Health & Exercise",
           fluidRow(
             column(width = 3,
                    dateRangeInput(
                      "date_range",
                      "Date range",
                      start = "2023-01-01",
                      end = Sys.Date(),
                      format = "d M yyyy",
                      weekstart = 1
                    ),
                    selectInput(
                      "resistance_exercise_selection", 
                      label = "Select resistance exercise to display",
                      choices = c(
                        "RDL" = "rdl",
                        "Leg press" = "horizontal_leg_press",
                        "Bench press" = "bench_press",
                        "Shoulder press" = "machine_shoulder_press",
                        "Tricep pushdown" = "bar_tricep_pushdown",
                        "Bicep curl" = "ez_bar_bicep_curl",
                        "Lat pulldown" = "lat_pulldown",
                        "Row" = "seated_pulley_row",
                        "Pulley crunch" = "pulley_crunch",
                        "Leg raise" = "forearm_leg_raises",
                        "Oblique twist" = "oblique_twist"
                      )
                    )
             ),
             column(width = 5,
                    h3("Resistance Training Weight in KG"),
                    plotOutput("resistance_exercise_plot")
             ),
             column(width = 4,
                    h3("Running Distance in KM"),
                    plotOutput("run_plot"))
           ),
           fluidRow(
             column(width = 3,
                    h3("Energy Intake in Kcal"),
                    plotOutput("energy_intake_plot")
             )
             ,
             column(width = 5,
                    h3("Body Weight in KG"),
                    plotOutput("weight_plot")
             ),
             column(width = 4,
                    h3("Sleep Hours"),
                    plotOutput("sleep_plot"))
           )
  )
			</code>
			</pre>
			<p>
			This created a page with two multi-column rows. This first row contains three columns: one with two user input fields to select a date range and a resistance training
			exercise to plot, one to output <code>resistance_exercise_plot</code>, and one to output <code>run_plot</code>. The second row also contains three columns to output
			<code>energy_intake_plot</code>, <code>weight_plot</code>, and <code>sleep_plot</code>. And, with that, the design of the UI was complete. The next step was to 
			create a connection to the database and update it when the user submits their data.			
			</p>
			<h3 id="section-four"> Connect to the database and update it with user input</h3>
			<p>
			I used the <code>DBI</code> and <code>ODBC</code> R packages to open a connection to my SQL Server database on Azure. 
			To do this, the database driver, server, name, user ID, and password are provided to the <code>dbConnect</code> function.
			</p>
			<pre>
			<code>
 # open db connection
 db_connection <- dbConnect(drv = odbc::odbc(),
                            Driver = "SQL Server",
                            server = servername,
                            database = dbname,
                            uid = user,
                            pwd = password)
			</code>
			</pre>
			<h3 id="section-five"><i> Add plots </i></h3>
			<h3 id="section-five-a"><i> Habits plots </i></h3>
			<h3 id="section-five-b"><i> Health & Exercise Plots </i></h3>
			<h3 id="section-six"> Deploy to shinyapps.io </h3>
		</section>
		<footer>
		</footer>
	</body>
</html>